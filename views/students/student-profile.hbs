<div class="d-flex justify-content-between feature-header">
    <div>
        <h3 class="content-head d-inline">{{featureTitle}}</h3> »
        <span><a href="/students"> Students</a></span>
    </div>
</div>

<div class="content-body">
    <section id="profile-info">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body d-flex justify-content-between">
                        <div>
                            <h4 id="student-name" class="primary text-uppercase font-weight-bold">{{student.firstName}}
                                {{student.middleName}} {{student.lastName}}
                            </h4>
                            <div>
                                <p class="d-inline">{{student.idType}}: </p>
                                <h5 class="d-inline-block">{{student.idNumber}}</h5>
                            </div>
                            <div>
                                <p class="d-inline">Phone: </p>
                                <h5 class="d-inline-block">{{student.phone}}</h5>
                            </div>
                        </div>
                    </div>

                    <div class="card-body student-profile">
                        <h5 class="text-bold-400 mb-2">STUDENT DETAILS
                            <span> | </span>
                            <a href="/student/edit/{{student._id}}">Edit</a>
                        </h5>

                        <div class="row">
                            <div class="col-md-4">
                                <h6 class="mb-0">Joined: </h6>
                                <p>{{formatDate student.createdAt "LL"}}</p>
                            </div>
                            <div class="col-md-4 ">
                                <h6 class="mb-0">First Class Date: </h6>
                                <p>{{formatDate student.firstClass "LL"}}</p>
                            </div>
                            <div class="col-md-4">
                                <h6 class="mb-0">Batch: </h6>
                                <p>{{student.batch}}</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">ID Type: </h6>
                                <p>{{student.idType}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">ID Number: </h6>
                                <p>{{student.idNumber}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Email:</h6>
                                <p>{{student.userId.email}}</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Gender: </h6>
                                <p>{{student.gender}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Birth Date: </h6>
                                <p>{{formatDate student.birthDate "LL"}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Age: </h6>
                                <p>{{ageInYears birthDate}} años</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Insurance: </h6>
                                <p>{{student.insurance}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Phone: </h6>
                                <p>{{student.phone}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Mobile: </h6>
                                <p>{{student.mobile}}</p>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Username: </h6>
                                <p>{{student.userId.username}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Address: </h6>
                                <p>{{student.address}}</p>
                            </div>
                            <div class="col-md-4 mt-1">
                                <h6 class="mb-0">Notes: </h6>
                                <p>{{student.notes}}</p>
                            </div>
                        </div>

                        <h5 class="text-bold-400 mt-2 student-profile-title">PARENTS
                            <span> | </span>
                            <a href="/student/{{student._id}}/parent/new">Add Parent</a>
                        </h5>

                        <section id="accordion-with-margin">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="card collapse-icon accordion-icon-rotate collapse-student-profile">
                                        <div class="card-body" style="padding:0;">
                                            <div class="accordion" id="accordionExample">
                                                {{#each parents}}
                                                <div data-crud="{{json this}}" class="collapse-margin">
                                                    <div class="card-header" id="heading{{@index}}"
                                                        data-toggle="collapse" role="button"
                                                        data-target="#collapse{{@index}}" aria-expanded="false"
                                                        aria-controls="collapse{{@index}}">
                                                        <span class="lead collapse-title">
                                                            {{firstName}} {{middleName}} {{lastName}}
                                                            {{#if representative}}
                                                            <span class="badge badge-danger">
                                                                Emergency
                                                            </span>
                                                            {{/if}}

                                                        </span>
                                                    </div>

                                                    <div id="collapse{{@index}}" class="collapse"
                                                        aria-labelledby="heading{{@index}}"
                                                        data-parent="#accordionExample">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Joined: </h6>
                                                                    <p>{{formatDate createdAt "LL"}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Kinship: </h6>
                                                                    <p>{{kinship}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Gender: </h6>
                                                                    <p>{{gender}}</p>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">ID Type: </h6>
                                                                    <p>{{idType}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">ID Number: </h6>
                                                                    <p>{{idNumber}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Email: </h6>
                                                                    <p>{{userId.email}}</p>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Birth Date: </h6>
                                                                    <p>{{formatDate birthDate "LL"}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Age: </h6>
                                                                    <p>{{ageInYears birthDate}} years</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Phone: </h6>
                                                                    <p>{{phone}}</p>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Mobile: </h6>
                                                                    <p>{{mobile}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Address: </h6>
                                                                    <p>{{address}}</p>
                                                                </div>
                                                                <div class="col-md-4 mt-1">
                                                                    <h6 class="mb-0">Notes: </h6>
                                                                    <p>{{notes}}</p>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-4 mt-1">
                                                                    <a
                                                                        href="/student/{{../student._id}}/parent/{{_id}}/edit">Edit
                                                                    </a> | 
                                                                    <a class="link-delete" href="#">Delete</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {{/each}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>



                        <div class="mt-5">
                            <h6 class="mb-0">Website:</h6>
                            <p>www.pixinvent.com</p>
                        </div>

                        <div class="mt-1">
                            <button type="button" class="btn btn-sm btn-icon btn-primary mr-25 p-25"><i
                                    class="feather icon-facebook"></i></button>
                            <button type="button" class="btn btn-sm btn-icon btn-primary mr-25 p-25"><i
                                    class="feather icon-twitter"></i></button>
                            <button type="button" class="btn btn-sm btn-icon btn-primary p-25"><i
                                    class="feather icon-instagram"></i></button>
                        </div>

                    </div>
                </div>


            </div>
        </div>
    </section>
</div>

{{#contentFor "pageScripts"}}
<script>
    (function (window, $) {
        "use strict";
        $(".link-delete").click(function () {
            let $btn = $(this);
            let $dv = $btn.closest(".collapse-margin");
            let $itm = $dv.data("crud");
            let $upUrl = "/student/" + $itm.studentId._id + "/parent/" + $itm._id + "/remove"
            let crudName = $itm.firstName + " " + $itm.middleName + " " + $itm.lastName;

            $.confirm({
                // icon: "fa fa-trash-o",
                closeIcon: true,
                backgroundDismiss: true,
                columnClass: "col-md-6",
                title: "<h4>Delete Confirmation</h4>",
                content: `<p class="mb-2">Are you sure you want to permanently remove <b>${crudName}</b>?</p>`,
                buttons: {
                    confirm: {
                        text: "Delete",
                        btnClass: "btn btn-danger",
                        keys: ["enter", "shift"],
                        action: function () {
                            window.location.href = $upUrl;
                        },
                    },
                    cancel: {
                        action: function () { },
                    },
                },
            });
        });
    })(window, jQuery);
</script>
{{/contentFor}}